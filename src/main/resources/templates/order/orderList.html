<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"/>

  <title>chicken stock</title>
  <!-- common css -->
  <link rel="stylesheet" type="text/css" th:href="@{/css/common/common.css}"/>

  <!-- order css -->
  <link rel="stylesheet" type="text/css" th:href="@{/css/order/inquire.css}">

  <!-- table css -->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" th:href="@{/css/common/style.css}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
  <script src="/js/common.js"></script>

  <!-- font awesome -->
  <script src="https://kit.fontawesome.com/da4b1b94bb.js" crossorigin="anonymous"></script>


</head>
<body>
  <div class="wrap">

    <!-- header -->
    <div th:include="common/userHeader.html"></div>

    <!-- S: container -->
    <div class="container px-0">

      <!-- S: aside -->
      <div th:replace="common/userSidebar.html"></div>
      <!-- E: aside -->

      <!-- S: main layout -->
      <div class="main_layout">
        <div class="main_layout_inner">

          <!-- 작업 영역 -->
          <!-- S: table -->
          <div class="container-fluid" style="margin-top:30px">
            <h3><i class="fa-solid fa-magnifying-glass"></i> 상품 조회</h3>
			      <br>

            <div class="input-group mb-3 col-12">
              <div class="dateList1"> 입고 예정일 : 
                <span id="dueDate">입고예정</span>
              </div>
              <div class="dateList2"> 발주 마감일 : 
                <span id="deadline">마감일</span>
              </div>
              <div class="dateList3" style="font-weight: bold;"> 현재 시각 : 
                <span id="clock">현재시각</span>
              </div>

              <div class="search-area" align="center">
                <form id="searchForm"
                      th:action="@{/order/list}"
                      method="get"
                      style="display: inline-block">

                  <input type="hidden" name="currentPage" value="1">
                  <select id="searchCondition" name="searchCondition" style="text-align: center;">
                    <option>== 선택 ==</option>
                    <option name="itemName" value="itemName">상품명</option>
                    <option name="category" value="category">카테고리</option>
                  </select>
                  <input class="form-control" type="search" id="searchValue" name="searchValue" placeholder="검색 내용을 입력해주세요.">
                  <button class="btn btn-warning" type="submit" style="color:#fff">검색</button>
                </form>
              </div>

              <div id="itemCondition">
                <p th:onclick="'location.href=\'/order/list/available\''">품절 상품 제외</p>
                <p> | </p>
                <p th:onclick="'location.href=\'/order/list/interest/select\''">관심 상품만 보기</p>
              </div>

              <div id="cartBox">
                <button class="btn btn-warning" type="submit" style="color:#fff" id="cartBtn">선택 담기</button>
              </div>

            </div>

            <table class="table">
              <thead>
                <tr>
                  <th>
                    <div class="form-check pb-3">
                      <input type="checkbox" class="form-check-input" name="option" value='selectall' onclick='selectAll(this)'/>
                    </div>
                  </th>
                  <th style="width: 90px;">상품코드</th>
                  <th style="width: 100px;">상품사진</th>
                  <th style="width: 145px;">상품명</th>
                  <th style="width: 145px;">카테고리</th>
                  <th style="width: 60px;">규격</th>
                  <th style="width: 100px;">제조사</th>
                  <th style="width: 100px;">판매가격</th>
                  <th style="width: 90px;">재고량</th>
                  <th style="width: 100px;">수량</th>
                  <th style="width: 100px;">품절여부</th>
                  <th style="width: 90px;">관심등록</th>
                  <th style="width: 5px;" class="emptyTbl"></th>

                </tr>
              </thead>
              <form action="insetItemIntoCartForm" method="post" id="cartForm">
              <tbody>
                <tr th:each="order : ${ orderList }">
                  <td>
                    <div class="form-check">
                      <input type="checkbox" class="form-check-input" id="check" name="cartCheckBox">
                      <label class="form-check-label" for="check"></label>
                    </div>
                  </td>
                  <input type="hidden" th:value="${ order.categoryNo }"/>
                  <!--<input type="text" name="storeName" th:value="${ #authentication.getPrincipal().getStoreName()}">-->
                  <td th:text="${ order.itemNo }" id="itemNo" name="test">상품코드</td>
                  <td>
                    <div class="img-info">
                      <div class="img-info__img">
                        <img th:src="'/images/' + ${ order.itemFile.fileName }" alt="">
                      </div>
                    </div>
                  </td>
                  <td th:text="${ order.itemName }">상품명</td>
                  <td th:text="${ order.categoryName }">카테고리</td>
                  <td th:text="${ order.itemStandard }">규격</td>
                  <td th:text="${ order.itemMake }">제조사(원산지)</td>
                  <td th:text="${ order.itemSales }">판매가격</td>
                  <td th:text="${ order.storeAmount }">재고량</td>
                  <td><input type="text" name="amount" size="6" placeholder="입력" id="cartAmount"
                             oninput="this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');"></td>
                  <td th:text="${ order.itemSoldoutYn }">품절여부</td>
                  <td>
                    <div class="dropdown open">
                      <a href="javascript:void(0);" class="px-2" id="triggerId1" data-toggle="dropdown" aria-haspopup="true"
                          aria-expanded="false">
                            <i class="fa fa-ellipsis-v" id="dotMenu"></i>
                      </a>
                      <div class="dropdown-menu" aria-labelledby="triggerId1">
                        <!-- <a class="dropdown-item" href="#"><i class="fa fa-eye mr-1"></i>View</a> -->

                        <a class="dropdown-item" href="javascript:void(0);" th:field="*{ order.cartAmount }"
                           th:itemNo="${order.itemNo}" th:categoryNo="${order.categoryNo}"
                           th:onclick="interest(this.getAttribute('itemNo'),this.getAttribute('categoryNo'))">
                          <i class="fa-solid fa-heart-circle-plus"></i> 관심 등록</a>
                      </div>
                    </div>
                  </td>
                  <td class="emptyTbl" th:text="${ order.categoryNo }">카테고리번호</td>
                </tr>
              </tbody>
              </form>
            </table>

          </div>
          <!-- E: table -->
          <!-- S: paging -->
          <div class="d-flex justify-content-center" id="pageBox">
            <button class="btn btn-light"
                    th:onclick="'location.href=\'/order/list?currentPage='+ @{${selectCriteria.startPage}} + '\''"
                    th:disabled="${selectCriteria.pageNo == 1}"><<</button>

            <button class="btn btn-light mx-1"
                    th:onclick="'location.href=\'/order/list?currentPage='+ @{${selectCriteria.pageNo - 1}} + '\''"
                    th:disabled="${selectCriteria.pageNo == 1}"><</button>

            <th:block th:each="page : ${#numbers.sequence(selectCriteria.startPage, selectCriteria.endPage)}">
              <button class="btn btn-warning mx-1" disabled style="color:white"
                      th:text="${ page }"
                      th:onclick="'location.href=\'/order/list?currentPage='+ @{${page}} + '\''"
                      th:disabled="${ selectCriteria.pageNo eq page }"></button>
            </th:block>

            <button class="btn btn-light mx-1"
                    th:onclick="'location.href=\'/order/list?currentPage='+ @{${selectCriteria.pageNo + 1}} + '\''"
                    th:disabled="${selectCriteria.pageNo == selectCriteria.maxPage}">></button>

            <button class="btn btn-light"
                    th:onclick="'location.href=\'/order/list?currentPage='+ @{${selectCriteria.maxPage}} + '\''"
                    th:disabled="${selectCriteria.pageNo == selectCriteria.maxPage}">>></button>
          </div>

          <!-- E: paging -->
        </div>
      </div>
      <!-- E: main layout -->
    </div>

    <!-- E: container -->
  </div>
  <!-- table js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

  <script type="text/javascript" th:src="@{/js/element.js}"></script>
  
  <!-- 입고 예정일 -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    let dueDateTest = document.getElementById("dueDate");
    function dueDate() {
      let date = new Date();
      let year = date.getFullYear();
      let month = date.getMonth();
      let clockDate = date.getDate();
      let day = date.getDay();
      let week = ['일', '월', '화', '수', '목', '금', '토'];

      dueDateTest.innerText = `${year}년 ${month+1}월 ${clockDate+1}일 ${week[day+1]}요일`;
    }
    dueDate();
    /*]]>*/
  </script>

  <!-- 발주 마감일 -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    let deadlineTest = document.getElementById("deadline");
    function deadline() {
      let date = new Date();
      let year = date.getFullYear();
      let month = date.getMonth();
      let clockDate = date.getDate();
      let day = date.getDay();
      let week = ['일', '월', '화', '수', '목', '금', '토'];

      deadlineTest.innerText = `${year}년 ${month+1}월 ${clockDate}일 ${week[day]}요일 23시 59분 59초`;

    }

    deadline();
    /*]]>*/
  </script>

  <!-- 현재 시각 -->
  <script th:inline="javascript">
    let clockTarget = document.getElementById("clock");
    function clock() {
      document.getElementById("clock").style.fontWeight="bold";
      let date = new Date();
      let year = date.getFullYear();
      let month = date.getMonth();
      let clockDate = date.getDate();
      let day = date.getDay();
      let week = ['일', '월', '화', '수', '목', '금', '토'];
      let hours = date.getHours();
      let minutes = date.getMinutes();
      let seconds = date.getSeconds();

      clockTarget.innerText = `${year}년 ${month+1}월 ${clockDate}일 ${week[day]}요일` +
      ` ${hours < 10 ? `0${hours}` : hours}시 ${minutes < 10 ? `0${minutes }` : minutes }분 ${seconds < 10 ? `0${seconds }` : seconds }초`;
    }
    function init() {
      clock();
      setInterval(clock, 1000);
    }
    init();
  </script>

  <!-- 관심 설정 -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    function interest(itemNo, categoryNo) {
      alert(itemNo+"번 상품이 관심 추가 되었습니다.");
      location.href= "list/interest/insert?itemNo="+itemNo+"&categoryNo="+categoryNo;
    }
    /*]]>*/
  </script>


    <!-- 장바구니 담기 -->
  <script th:inline="javascript">
    function cartAlert(itemNo) {
      let result = confirm("선택 제품이 장바구니에 담겼습니다.\n장바구니로 이동하시겠습니까?");
      if(result == true) {
        location = url;
      }
    }
  </script>

  <!-- 체크 박스 전체 선택 -->
  <script th:inline="javascript">
    function selectAll(selectAll)  {
        const checkboxes = document.getElementsByName('option');
    
        checkboxes.forEach((checkbox) => {
        checkbox.checked = selectAll.checked;
        })
    }
  </script>

  <!-- form Ajax-->
  <script>
  $("#cartBtn").click(function() {
    var rowData = new Array();
    var tdArr = new Array();
    var checkbox = $("input[name=cartCheckBox]:checked");

    checkbox.each(function(i) {
      var tr = checkbox.parent().parent().eq(i);
      var td = tr.children();

      rowData.push(tr.text());

      var itemNo = td.eq(1).text();
      var cartAmount = td.eq(10).text;
      var categoryNo = td.eq(13).text;

      tdArr.push(itemNo);
      tdArr.push(cartAmount);
      tdArr.push(categoryNo);

      console.log("itemNo : " + itemNo);
      console.log("cartAmount " + cartAmount);
      console.log("categoryNo : " + categoryNo);

    });

  });

  </script>
</body>
</html>